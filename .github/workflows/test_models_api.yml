name: Test GitHub Models API (Hello World)
on:
  workflow_dispatch:

permissions:
  contents: read
  models: read

jobs:
  ping-model:
    runs-on: ubuntu-latest
    steps:
      - name: üß† Call GitHub Models API
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          set -euo pipefail
          ORG="${{ github.repository_owner }}"
          echo "Testing Models API for org: $ORG"

          jq -n \
            --arg input "Hello from GitHub Actions ‚Äî please respond with 'pong'." \
            '{ input: $input, parameters: { temperature: 0.2 } }' > req.json
          cat req.json
          echo

          echo "Calling https://api.github.com/orgs/$ORG/copilot/models/openai/gpt-4o-mini/inference"
          echo

          HTTP_CODE=$(curl -s -w "%{http_code}" -o resp.json \
            -X POST \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            -H "Content-Type: application/json" \
            "https://api.github.com/orgs/$ORG/copilot/models/openai/gpt-4o-mini/inference" \
            --data @req.json)

          echo "HTTP status: $HTTP_CODE"
          echo "Response:"
          cat resp.json
          echo

          # Fail if not a 2xx code
          if [[ ! "$HTTP_CODE" =~ ^2 ]]; then
            echo "‚ùå Models API call failed (HTTP $HTTP_CODE)"
            exit 1
          fi

          echo "‚úÖ Models API call succeeded!"
